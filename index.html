<!DOCTYPE html>
<html>
    <head>
        <title>Beyer Music Player // Mozilla Dev Derby</title>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.1/angular.min.js"></script>
        <link rel="stylesheet" type="text/css" href="http://cdn.jsdelivr.net/foundation/3.2.4/stylesheets/foundation.min.css">
        <style type="text/css">
            #dropzone {
                text-align: center;
            }

            #dropzone.over {
                background-color: rgba(43, 166, 203, 0.7);
            }
        </style>
        <script type="text/javascript">
            Beyer = {};
            Beyer.Playlist = {
                audio: null,
                trackList: [],
                addTrack: function(track) {
                    this.trackList = this.trackList.concat(track);
                },
                play: function(index) {
                    var reader = new FileReader(),
                        track = this.trackList[index || 0],
                        that = this;

                    reader.onload = (function(track) {
                        return function(e) {
                            that.audio = new Audio();
                            that.audio.src = e.target.result;
                            that.audio.load();
                            that.audio.play();
                        };
                    })(track);

                    reader.readAsDataURL(track);
                },
                pause: function() {
                    this.audio.pause();
                }
            }

            // AngularJS
            Beyer.app = angular.module('beyer', []).config(['$routeProvider', function($routeProvider) {
                $routeProvider
                    .when('/', {
                        templateUrl: 'partials/artist-list.html',
                        controller: Shiva.Controllers.ArtistList
                    })
                    .otherwise({redirectTo: '/'});
            }]);

            document.addEventListener('DOMContentLoaded', function() {
                var dropzone = document.getElementById('dropzone');

                dropzone.addEventListener('drop', function (e) {
                    e.target.classList.remove('over');
                    e.stopPropagation();
                    e.preventDefault();

                    var tracks = e.dataTransfer.files;
                    for (var i = 0, track; track = tracks[i]; i++) {
                        Beyer.Playlist.addTrack(track);
                    }
                    Beyer.Playlist.play();
                }, false);

                dropzone.addEventListener('dragend', function (e) {
                    e.target.classList.remove('over');
                }, false);

                dropzone.addEventListener('dragenter', function (e) {
                    e.target.classList.add('over');
                }, false);

                dropzone.addEventListener('dragover', function (e) {
                    e.stopPropagation();
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'copy';
                }, false)

                dropzone.addEventListener('dragleave', function (e) {
                    e.target.classList.remove('over');
                }, false);
            }, false);
        </script>
    </head>

    <body>
        <div class="row">
            <h1>
                Beyer Music Player
            </h1>

            <hr>

            <div id="dropzone" class="panel callout radius">
                Drop files here
            </div>

            <h2>
                Playlist
            </h2>
            <div id="playlist" class="panel radius">
                Empty
            </div>
        </div>
    </body>
</html>
